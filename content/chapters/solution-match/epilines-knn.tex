\subsection{Epilines + KNN}
\label{sec:match:epi-knn}

Traditional stereoscopy finds the correct pixel on the epiline by comparing the patch around the original pixels to patches around the epiline.
This idea of ``looking at the neighborhood'' was evolved to our case into a k-Nearest Neighbor search.

\subsubsection{Algorithm}

The algorithm processes each camera with the following steps:
\begin{enumerate}
	\itemsep 0em
	\item Compute the kNN of all bubbles of both the main and the side camera, storing them as relative offsets from the bubble's position;
	\item For each bubble in the main camera:
	      \begin{enumerate}
		      \item Compute the coefficients $a$, $b$ and $c$ of the epiline $ax+by+c{=}0$;
		      \item Compute the distance (with a scale factor) of all bubbles $(x_i, y_i)$ in the side camera to the epiline: $d_i = ax_i + by_i + c$;
		      \item Consider only the bubbles with $d_i<T$, for a specific threshold $T$ (if there are none, leave the bubble unmatched);
		      \item Compute the cosine similarity between the bubble in the main camera and the others, considering the positions of the kNNs;
		      \item Select as match the bubble with highest cosine similarity, provided that it has at least a minimum value for that (if not, leave the bubble unmatched).
	      \end{enumerate}
\end{enumerate}

\subsubsection{Evaluation}

Similarly to the previous approach, this algorithm has an acceptable speed (122 FPS), but an extremely bad quality, with 2/28/0 correct/missed/wrong matches in the 30-bubbles dataset, and 1/98/1 in the 100-bubbles dataset.
